<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Stryker Mutator RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Stryker Mutator Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Stryker Mutator" href="/opensearch.xml"><title data-react-helmet="true">Mutation switching in Stryker4s | Stryker Mutator</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://stryker-mutator.io/images/strykerman.png"><meta data-react-helmet="true" name="twitter:image" content="https://stryker-mutator.io/images/strykerman.png"><meta data-react-helmet="true" property="og:url" content="https://stryker-mutator.io/blog/mutation-switching"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="keywords" content="mutation testing, JavaScript, TypeScript, C#, .NET, Scala, testing, testing tools, software"><meta data-react-helmet="true" property="og:title" content="Mutation switching in Stryker4s | Stryker Mutator"><meta data-react-helmet="true" name="description" content="Learn how Stryker4s uses mutation switching to improve performance."><meta data-react-helmet="true" property="og:description" content="Learn how Stryker4s uses mutation switching to improve performance."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2018-10-06T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/nicojs"><meta data-react-helmet="true" property="article:tag" content="stryker4s"><link data-react-helmet="true" rel="icon" href="/images/stryker.svg"><link data-react-helmet="true" rel="canonical" href="https://stryker-mutator.io/blog/mutation-switching"><link data-react-helmet="true" rel="alternate" href="https://stryker-mutator.io/blog/mutation-switching" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://stryker-mutator.io/blog/mutation-switching" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://QF3A1J09N2-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.2a012d1e.css">
<link rel="preload" href="/assets/js/runtime~main.c60f9130.js" as="script">
<link rel="preload" href="/assets/js/main.f27ba657.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:var(--ifm-navbar-background-color, #fff);color:var(--ifm-navbar-link-color, #000)" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP">üìΩÔ∏è <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=Vq9eqZzblfg">Watch the talk "Who is testing your tests?" from <i>Scala Love in the City</i></a></div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/stryker.svg" alt="Stryker Mutator Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/images/stryker.svg" alt="Stryker Mutator Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Stryker Mutator</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/docs/stryker-js/introduction">For JavaScript</a><a class="navbar__item navbar__link" href="/docs/stryker-net/introduction">For C#</a><a class="navbar__item navbar__link" href="/docs/stryker4s/getting-started">For Scala</a><a class="navbar__item navbar__link" href="/docs/General/example">An example</a></div><div class="navbar__items navbar__items--right"><a href="https://dashboard.stryker-mutator.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Dashboard<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link header-github-link" target="_self" aria-label="GitHub repository dropdown"></a><ul class="dropdown__menu"><li><a href="https://github.com/stryker-mutator/stryker-js" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>StrykerJS (JS &amp; TS)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/stryker-mutator/stryker-net" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Stryker.NET (C#)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/stryker-mutator/stryker4s" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Stryker4s (Scala)<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/stryker-mutator/mutation-testing-elements" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Mutation Testing Elements<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/stryker-mutator/stryker-mutator.github.io" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>This website<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/2021-30-10-announcing-stryker-net-1.md">Announcing Stryker.NET 1.0</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/stryker4s-40-minutes-to-40-seconds">Stryker4s: from 40 minutes to 40 seconds</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/announcing-stryker-js-5-brave-new-dimension.md">Announcing StrykerJS 5.0 - Brave new Dimension</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/announcing-stryker-4-mutation-switching">Announcing Stryker 4.0 - Mutation Switching</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/announcing-stryker-4-beta-mutation-switching">Announcing Stryker 4.0 Beta</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Mutation switching in Stryker4s</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2018-10-06T00:00:00.000Z" itemprop="datePublished">October 6, 2018</time> ¬∑ <!-- -->6 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/nicojs" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://avatars3.githubusercontent.com/u/1828233?s=400&amp;u=fec18ad3776aaafec54c49bbd7173a841ae7ea59&amp;v=4" alt="Nico Jansen"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nicojs" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nico Jansen</span></a></div><small class="avatar__subtitle" itemprop="description">Stryker Team</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Learn how Stryker4s uses mutation switching to improve performance.</p><p>We are very happy with Stryker&#x27;s new friends! One of those new friends is Stryker4s(cala).
Scala developers can now use mutation testing to improve their tests!
Creating a mutation testing framework for Scala comes with many challenges.
One of those challenges is the Scala compiler itself.
We all know it&#x27;s not the <a href="https://scala-ci.typesafe.com/grafana/dashboard/db/scala-benchmark?from=1429139130109&amp;to=1492531027936h&amp;orgId=1&amp;var-branch=2.11.x&amp;var-branch=2.12.x&amp;var-branch=2.13.x&amp;var-source=scala&amp;var-bench=HotScalacBenchmark.compile&amp;var-host=scalabench@scalabench@" target="_blank" rel="noopener noreferrer">fastest in its kind</a>.
One of the main goals of Stryker is to be fast. This means we need to come up with an intelligent way to introduce the mutants into the source code.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="attempt-one-compiling-each-mutation">Attempt one: Compiling each mutation<a class="hash-link" href="#attempt-one-compiling-each-mutation" title="Direct link to heading">‚Äã</a></h2><p>One way of introducing mutants to a codebase is by mutating one statement, compile the code, run tests, gather the results and repeat.
This seems like a logical choice because it mimics the way a developer would go about it.</p><p>Let&#x27;s look at an example.</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">class Numbers {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def greaterThan(a: Int, b: Int): Boolean = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        a &gt; b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Mutant 1: a &gt;= b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Mutant 2: a &lt; b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Mutant 3: a == b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As you can see, there are three possible mutants:</p><ol><li>Change <code>&gt;</code> to <code>&gt;=</code></li><li>Change <code>&gt;</code> to <code>&lt;</code></li><li>Change <code>&gt;</code> to <code>==</code></li></ol><p>If we apply the mutation one by one, we would need to compile the code base three times.
If we assume the compile time of this program is 10 seconds, we already have 30 seconds of compile time for one full mutation run.
This would quickly get out of hand when the codebase is bigger and generates more mutants.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="attempt-two-mutating-bytecode">Attempt two: Mutating bytecode<a class="hash-link" href="#attempt-two-mutating-bytecode" title="Direct link to heading">‚Äã</a></h2><p>As you might know, Scala gets compiled to Java bytecode. This gives us an alternative way to introduce mutations in a codebase.
We would be able to mutate the bytecode directly, eliminating the need for recompiling.</p><p>The main challenge with this approach is that <a href="https://docs.scala-lang.org/overviews/core/binary-compatibility-of-scala-releases.html" target="_blank" rel="noopener noreferrer">Scala doesn&#x27;t guarantee the bytecode output for each version of the compiler</a> (or even JDK version).
Even the jump from Scala 2.12 to 2.13 produces different bytecode. This would make manipulating bytecode complicated, unpredictable and hard to maintain.</p><p>Furthermore, if you mutate the bytecode, it can be difficult to reproduce the exact Scala code that you changed.
Details, like the exact location, are not represented in bytecode.
Scala makes this extra challenging, as 1 <code>.scala</code> file can easily result in 100 <code>.class</code> files in bytecode.</p><p>For performance reasons, mutating bytecode might sound like a fast solution, but you would still need to load (or hot reload) the mutated class files
for each mutant.</p><p>There should be a better solution out there, right?</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="solution-mutation-switching">Solution: Mutation switching<a class="hash-link" href="#solution-mutation-switching" title="Direct link to heading">‚Äã</a></h2><p>Mutation switching to the rescue! So how is mutation switching both <em>faster</em> and <em>more reliable</em> than compiling each mutation or mutating bytecode?
The steps are quite similar to &quot;Compiling each mutant&quot;, but with some big differences:</p><ol><li>All mutants are identified for the whole codebase.</li><li>All mutants are applied to the codebase <strong>at the same time</strong> using a <a href="https://docs.scala-lang.org/tour/pattern-matching.html" target="_blank" rel="noopener noreferrer">Scala Pattern match</a>.</li><li>All mutants are tested one by one, with only <strong>one mutant active at a time</strong>, using an environment variable.</li></ol><p>Step 2 is where the magic happens. Let&#x27;s take a look at the same code example as used previously, right after the mutations are applied.</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">class Numbers {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def greaterThan(a: Int, b: Int): Boolean = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.env.get(&quot;ACTIVE_MUTATION&quot;) match {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case Some(&quot;0&quot;) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                a &gt;= b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case Some(&quot;1&quot;) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                a &lt; b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case Some(&quot;2&quot;) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                a == b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case _ =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                a &gt; b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>All possible mutations are implemented in the pattern match. An identifier is used to turn on/off, or <em>switch</em>, specific mutations.
The default case will be used when none of the mutants are active. Now the code base only needs to be compiled once.
The extra time compilation takes because of its increased size is negligible compared to the overhead of compiling each mutant.
For example, if the compilation time for this code base
would be 15 seconds we will still gain 15 seconds compared to compiling each mutation.</p><p>We gain performance without losing flexibility. It&#x27;s a win-win scenario.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="top-statements">Top statements<a class="hash-link" href="#top-statements" title="Direct link to heading">‚Äã</a></h2><p>Mutation switching sure is great, but let&#x27;s take a look at a more complex example.</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">def isEven(number: Int): Boolean = number % 2 == 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def isOdd(number: Int): Boolean = !isEven(number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val numbers: List[Int] = 1 to 100 toList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def filterOddAnd(specialNumber: Int): List[Int] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  numbers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .filter(isOdd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .filterNot(_.equals(specialNumber))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>With this code base <code>filter</code> and <code>filterNot</code> could be mutated to their counterparts.
This would give us the following code base if we implement the pattern match at the direct position.</p><div class="codeBlockContainer_J+bg language-scala theme-code-block"><div class="codeBlockContent_csEI scala"><pre tabindex="0" class="prism-code language-scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">def isEven(number: Int): Boolean = number % 2 == 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def isOdd(number: Int): Boolean = !isEven(number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val numbers: List[Int] = 1 to 100 toList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def filterOddAnd(specialNumber: Int): List[Int] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  numbers.(sys.env.get(&quot;ACTIVE_MUTATION&quot;) match {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case Some(&quot;0&quot;) =&gt; .filter(isOdd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case _         =&gt; .filterNot(isOdd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (sys.env.get(&quot;ACTIVE_MUTATION&quot;) match {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case Some(&quot;1&quot;) =&gt;  .filterNot(_.equals(specialNumber))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case _         =&gt;  .filter(_.equals(specialNumber))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Because we wrapped the functions right on the spot we produced code that doesn&#x27;t even compile!
To make the code compile we need to take a closer look at the abstract syntax tree.
We are searching for the parent statement in this abstract syntax tree, which is <code>numbers</code> in our case.
If we implement mutation switching using the parent statement, we can generate the following code.</p><div class="codeBlockContainer_J+bg language-Scala theme-code-block"><div class="codeBlockContent_csEI Scala"><pre tabindex="0" class="prism-code language-Scala codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">def isEven(number: Int): Boolean = number % 2 == 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def isOdd(number: Int): Boolean = !isEven(number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">val numbers: List[Int] = 1 to 100 toList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def filterOddAnd(specialNumber: Int): List[Int] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sys.env.get(&quot;ACTIVE_MUTATION&quot;) match {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case Some(&quot;0&quot;) =&gt; numbers.filterNot(isOdd).filter(_.equals(specialNumber))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case Some(&quot;1&quot;) =&gt; numbers.filter(isOdd).filter(_.equals(specialNumber))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case _         =&gt; numbers.filter(isOdd).filterNot(_.equals(specialNumber))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This enables us to get clean, readable pattern matches and avoid compilation errors.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="whats-next">What&#x27;s next?<a class="hash-link" href="#whats-next" title="Direct link to heading">‚Äã</a></h2><p>With mutation switching in place, the road is clear for even bigger performance improvements. Right now, we&#x27;re not
keeping the testing process alive. We simply run <code>sbt test</code> with the correct mutant switched on.
Keeping the test process alive and rerunning the tests after switching mutants is where we can really put the pedal to the metal!</p><p>Interested to help? We&#x27;re very much looking for contributions! Take a look at our <a href="https://github.com/stryker-mutator/stryker4s/issues" target="_blank" rel="noopener noreferrer">issue tracker</a>
or contact us on <a href="https://join.slack.com/t/stryker-mutator/shared_invite/enQtOTUyMTYyNTg1NDQ0LTU4ODNmZDlmN2I3MmEyMTVhYjZlYmJkOThlNTY3NTM1M2QxYmM5YTM3ODQxYmJjY2YyYzllM2RkMmM1NjNjZjM" target="_blank" rel="noopener noreferrer">Slack</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">‚Äã</a></h2><p>With the combination of mutation switching and traversing to the parent statements Stryker4s is able to apply mutations to the codebase
in a clean and understandable fashion and keep the chances of compilation errors to a minimum.
We hope this blog gave some insight on mutation switching works and how Stryker4s uses this to its advantage. Happy mutating!</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/stryker-4-s">stryker4s</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/stryker-mutator/stryker-mutator.github.io/edit/develop/blog/2018-10-06-mutation-switching.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/announcing-stryker-0-34"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">¬´ <!-- -->Announcing Stryker 0.34</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/csharp-and-scala-support"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Introducing Stryker.NET and Stryker4s<!-- --> ¬ª</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#attempt-one-compiling-each-mutation" class="table-of-contents__link toc-highlight">Attempt one: Compiling each mutation</a></li><li><a href="#attempt-two-mutating-bytecode" class="table-of-contents__link toc-highlight">Attempt two: Mutating bytecode</a></li><li><a href="#solution-mutation-switching" class="table-of-contents__link toc-highlight">Solution: Mutation switching</a></li><li><a href="#top-statements" class="table-of-contents__link toc-highlight">Top statements</a></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What&#39;s next?</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/General/faq">FAQ</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/stryker-mutator/shared_invite/enQtOTUyMTYyNTg1NDQ0LTU4ODNmZDlmN2I3MmEyMTVhYjZlYmJkOThlNTY3NTM1M2QxYmM5YTM3ODQxYmJjY2YyYzllM2RkMmM1NjNjZjM" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/stryker_mutator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/stryker-mutator/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://infosupport.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/images/info-support.svg" alt="Info Support Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/images/info-support.svg" alt="Info Support Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Powered by <a target="_blank" rel="noopener noreferrer" href="https://www.infosupport.com/open-source/">Info Support</a>.<br>Stryker is released under the Apache 2.0 license. Site by the <a target="_blank" rel="noopener noreferrer" href="https://github.com/orgs/stryker-mutator/people">Stryker team</a>. Logo by Selina van den Top.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c60f9130.js"></script>
<script src="/assets/js/main.f27ba657.js"></script>
</body>
</html>